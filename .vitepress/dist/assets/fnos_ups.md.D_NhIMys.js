import{_ as i,c as a,a2 as n,o as p}from"./chunks/framework.eme8ZeBJ.js";const c=JSON.parse('{"title":"fnOS 配置 UPS","description":"","frontmatter":{},"headers":[],"relativePath":"fnos/ups.md","filePath":"fnos/ups.md","lastUpdated":1728585976000}'),h={name:"fnos/ups.md"};function l(k,s,t,e,F,d){return p(),a("div",null,s[0]||(s[0]=[n(`<h1 id="fnos-配置-ups" tabindex="-1">fnOS 配置 UPS <a class="header-anchor" href="#fnos-配置-ups" aria-label="Permalink to &quot;fnOS 配置 UPS&quot;">​</a></h1><p><img src="https://img.slarker.me/wiki/power.webp" alt=""></p><div class="info custom-block"><p class="custom-block-title">提示</p><ul><li>如果你的 NAS 是直接安装的 fnOS，那可以参考本教程配置 UPS。</li><li>如果你的 fnOS 是通过 PVE 安装的虚拟机，那你应该在 PVE 中配置 UPS，由于 PVE 和 fnOS 同样都基于 Debian，所以在 PVE 中配置 UPS 和在 fnOS 中的设置完全一致。</li></ul></div><p>尽管 fnOS 目前官方不支持 UPS，不过 fnOS 基于 <code>Debian</code> 开发，如果想使用 UPS，也非常简单，可以通过 <code>ssh</code> 命令行配置。</p><p>以我使用的山特 TG-Box 850 为例，将 UPS 的 USB 信号线插到 NAS 的 USB 接口。<a href="/fnos/ssh.html">使用 SSH 登录</a> fnOS，并切换到 <code>root</code> 用户，依次执行下面的命令。</p><h2 id="安装-apcupsd" tabindex="-1">安装 apcupsd <a class="header-anchor" href="#安装-apcupsd" aria-label="Permalink to &quot;安装 apcupsd&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">Tips</p><p>Apcupsd 是一款功能强大的软件，专门用于监控不间断电源（UPS）系统。</p></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 更新 apt 源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 apcupsd，期间会提示操作会占用一定空间，输入 Y 确认</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apcupsd</span></span></code></pre></div><h2 id="编辑-ups-配置" tabindex="-1">编辑 UPS 配置 <a class="header-anchor" href="#编辑-ups-配置" aria-label="Permalink to &quot;编辑 UPS 配置&quot;">​</a></h2><p>apcupsd 的配置文件在 <code>/etc/apcupsd/apcupsd.conf</code>，可以使用 <code>nano</code> 编辑器打开文件：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apcupsd/apcupsd.conf</span></span></code></pre></div><p>具体要修改的配置如下：</p><div class="info custom-block"><p class="custom-block-title">提示</p><ul><li>Linux 的配置文件中，如果该行前面有 <code>#</code>，表示注释，可以忽略。如果需要让本行配置生效，需要删除 <code>#</code>。</li><li>由于配置项比较多，需要修改的配置仅有下面几项，找到需要修改的配置所在的行，修改即可。其它没有提到的配置，无须修改，保持默认。</li></ul></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除 UPSNAME 前面的 #，可以改成自己的 UPS 型号，比如 \`tg-box850\`。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UPSNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tg-box850</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果 UPS 使用 USB 接口的信号线，请注释下面这行（在下面这行前面加 #）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DEVICE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/ttyS0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除 POLLTIME 名称前面的 #，POLLTIME 表示检测 ups 状态的间隔时间，默认 60 秒</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POLLTIME</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>以下三个设置中只要有一个满足，自动关机就会被触发</p></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UPS 剩余电量低于 80%，开始自动关机，默认为 5，可以改成 80。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BATTERYLEVEL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UPS 剩余电量不超过 3 分钟，开始自动关机</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MINUTES</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 市电中断超过 60 秒后，开始自动关机，默认为 0，可以改成 60。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TIMEOUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span></span></code></pre></div><p>修改完成之后，<code>Ctrl+X</code>，输入 <code>Y</code>，回车确认退出。</p><h2 id="配置服务" tabindex="-1">配置服务 <a class="header-anchor" href="#配置服务" aria-label="Permalink to &quot;配置服务&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apcupsd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置开机自启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apcupsd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apcupsd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apcupsd</span></span></code></pre></div><p><img src="https://img.slarker.me/wiki/Snipaste_2024-09-14_21-53-30.webp" alt=""></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 UPS 状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apcaccess</span></span></code></pre></div><p>配置成功如下所示：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">APC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 001,028,0667</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2024-10-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:30:26</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HOSTNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fnOS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.14.14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (31 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">May</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2016</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) debian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UPSNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tg-box850</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Cable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DRIVER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UPS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Driver</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UPSMODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Stand</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Alone</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">STARTTIME:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2024-10-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:30:22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MODEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SANTAK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TG-BOX</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ONLINE</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 状态为 ONLINE（在线）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LOADPCT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Percent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BCHARGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Percent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TIMELEFT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 44.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Minutes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MBATTCHG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Percent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MINTIMEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Minutes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MAXTIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OUTPUTV</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 230.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Volts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DWAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LOTRANS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 184.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Volts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HITRANS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 264.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Volts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ALARMDEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NUMXFERS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TONBATT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CUMONBATT:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">XOFFBATT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N/A</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">STATFLAG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x05000008</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SERIALNO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> APC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2024-10-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:30:27</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span></span></code></pre></div>`,23)]))}const g=i(h,[["render",l]]);export{c as __pageData,g as default};
