import{_ as e,c as a,a2 as s,o as r}from"./chunks/framework.eme8ZeBJ.js";const k=JSON.parse('{"title":"Docker Compose 模板","description":"","frontmatter":{},"headers":[],"relativePath":"application/compose.md","filePath":"application/compose.md","lastUpdated":1734839697000}'),l={name:"application/compose.md"};function n(i,t,d,o,c,p){return r(),a("div",null,t[0]||(t[0]=[s(`<h1 id="docker-compose-模板" tabindex="-1">Docker Compose 模板 <a class="header-anchor" href="#docker-compose-模板" aria-label="Permalink to &quot;Docker Compose 模板&quot;">​</a></h1><p><img src="https://img.slarker.me/wiki/d1f910c1b4c74765ba2754b10c8002e3.jpeg" alt=""></p><blockquote><p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后可以方便地从 YML 文件配置中创建并启动所有服务。</p></blockquote><p>Unraid，fnOS，群晖等 NAS 系统都支持 Compose，很多通过自带的 docker GUI 无法配置的选项，都可以通过 Compose 使用 YML 配置文件来实现。而且 Compose 具有修改配置方便，方便备份，迁移等优点。</p><h2 id="compose-模板" tabindex="-1">Compose 模板 <a class="header-anchor" href="#compose-模板" aria-label="Permalink to &quot;Compose 模板&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><ul><li>下面的 Compose 模板在 fnOS 中测试，也同时适用于群晖和 Unraid，仅需要修改对应的数据挂载路径。</li><li>下面所有 Compose 模板默认映射的文件夹路径都位于 <code>/vol1</code>，你需要根据自己的实际情况做出修改。</li><li>部分应用比如 <code>emby</code>，<code>jellyfin</code> 的默认端口都一样，如果需要同时安装，注意修改端口。</li><li>immich 需要将 <code>env</code> 配置文件名称修改为 <code>.env</code>。</li></ul></div><p>这里分享一些常用的 <a href="https://www.123pan.com/s/1JKMjv-ICao" target="_blank" rel="noreferrer">Compose 模板</a>，包含以下应用：</p><table tabindex="0"><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">介绍</th><th style="text-align:center;">挂载目录</th><th style="text-align:center;">默认 Web 端口</th></tr></thead><tbody><tr><td style="text-align:center;"><a href="https://alist.nn.ci/zh/" target="_blank" rel="noreferrer">AList</a></td><td style="text-align:center;">挂载网盘</td><td style="text-align:center;">-</td><td style="text-align:center;">5244</td></tr><tr><td style="text-align:center;"><a href="https://github.com/P3TERX/Aria2-Pro-Docker" target="_blank" rel="noreferrer">Aria2-Pro</a></td><td style="text-align:center;">轻量级下载工具</td><td style="text-align:center;">downloads</td><td style="text-align:center;">6880</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/johngong/baidunetdisk" target="_blank" rel="noreferrer">BaiduDisk</a></td><td style="text-align:center;">百度网盘</td><td style="text-align:center;">downloads</td><td style="text-align:center;">5800</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/linuxserver/calibre-web" target="_blank" rel="noreferrer">Calibre-Web</a></td><td style="text-align:center;">电子书库</td><td style="text-align:center;">books</td><td style="text-align:center;">8083</td></tr><tr><td style="text-align:center;"><a href="https://www.cloudbak.org/install/install-docker.html" target="_blank" rel="noreferrer">Cloudbak</a></td><td style="text-align:center;">云朵备份，备份微信</td><td style="text-align:center;">cloudbak</td><td style="text-align:center;">9527</td></tr><tr><td style="text-align:center;"><a href="https://www.clouddrive2.com/" target="_blank" rel="noreferrer">CloudDrive2</a></td><td style="text-align:center;">映射网盘到本地</td><td style="text-align:center;">clouddrive</td><td style="text-align:center;">19798</td></tr><tr><td style="text-align:center;"><a href="https://github.com/jeessy2/ddns-go" target="_blank" rel="noreferrer">DDNS-Go</a></td><td style="text-align:center;">自动绑定公网 IP 到对应域名</td><td style="text-align:center;">-</td><td style="text-align:center;">9876</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/amilys/embyserver" target="_blank" rel="noreferrer">Emby</a></td><td style="text-align:center;">影视媒体库</td><td style="text-align:center;">downloads</td><td style="text-align:center;">8096</td></tr><tr><td style="text-align:center;"><a href="https://github.com/filebrowser/filebrowser" target="_blank" rel="noreferrer">FileBrowser</a></td><td style="text-align:center;">文件管理器</td><td style="text-align:center;">vol1</td><td style="text-align:center;">9000</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/nyanmisaka/jellyfin" target="_blank" rel="noreferrer">Jellyfin</a></td><td style="text-align:center;">开源的影视媒体库</td><td style="text-align:center;">downloads</td><td style="text-align:center;">8096</td></tr><tr><td style="text-align:center;"><a href="https://immich.app/" target="_blank" rel="noreferrer">Immich</a></td><td style="text-align:center;">照片备份</td><td style="text-align:center;">photos</td><td style="text-align:center;">2283</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/networkstatic/iperf3" target="_blank" rel="noreferrer">iPerf3</a></td><td style="text-align:center;">网络带宽性能测试</td><td style="text-align:center;">-</td><td style="text-align:center;">5201</td></tr><tr><td style="text-align:center;"><a href="https://docs.linuxserver.io/images/docker-librespeed/" target="_blank" rel="noreferrer">LibreSpeed</a></td><td style="text-align:center;">网速测试</td><td style="text-align:center;">-</td><td style="text-align:center;">9001</td></tr><tr><td style="text-align:center;"><a href="https://github.com/alexta69/metube" target="_blank" rel="noreferrer">Metube</a></td><td style="text-align:center;">下载在线视频</td><td style="text-align:center;">downloads</td><td style="text-align:center;">8081</td></tr><tr><td style="text-align:center;"><a href="https://github.com/usememos/memos" target="_blank" rel="noreferrer">Memos</a></td><td style="text-align:center;">开源的日记、微博应用</td><td style="text-align:center;">-</td><td style="text-align:center;">5230</td></tr><tr><td style="text-align:center;"><a href="https://miniflux.app/" target="_blank" rel="noreferrer">Miniflux</a></td><td style="text-align:center;">极简的 RSS 阅读器</td><td style="text-align:center;">-</td><td style="text-align:center;">8020</td></tr><tr><td style="text-align:center;"><a href="https://metatube-community.github.io/README_ZH/" target="_blank" rel="noreferrer">Metatube</a></td><td style="text-align:center;">小姐姐刮削服务端</td><td style="text-align:center;">-</td><td style="text-align:center;">8900</td></tr><tr><td style="text-align:center;"><a href="https://github.com/navidrome/navidrome" target="_blank" rel="noreferrer">Navidrome</a></td><td style="text-align:center;">音乐库</td><td style="text-align:center;">musics</td><td style="text-align:center;">4533</td></tr><tr><td style="text-align:center;"><a href="https://planka.app" target="_blank" rel="noreferrer">Planka</a></td><td style="text-align:center;">看板</td><td style="text-align:center;">-</td><td style="text-align:center;">5000</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/linuxserver/qbittorrent" target="_blank" rel="noreferrer">qBittorrent</a></td><td style="text-align:center;">BT、PT 下载客户端</td><td style="text-align:center;">downloads</td><td style="text-align:center;">8080</td></tr><tr><td style="text-align:center;"><a href="https://docs.rsshub.app/" target="_blank" rel="noreferrer">RSSHub</a></td><td style="text-align:center;">一切皆可 RSS！</td><td style="text-align:center;">-</td><td style="text-align:center;">1200</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/openspeedtest/latest" target="_blank" rel="noreferrer">SpeedTest</a></td><td style="text-align:center;">网速测试</td><td style="text-align:center;">-</td><td style="text-align:center;">9002</td></tr><tr><td style="text-align:center;"><a href="https://docs.linuxserver.io/images/docker-syncthing" target="_blank" rel="noreferrer">Syncthing</a></td><td style="text-align:center;">跨平台文件同步</td><td style="text-align:center;">syncthing</td><td style="text-align:center;">8384</td></tr><tr><td style="text-align:center;"><a href="https://github.com/Jeric-X/SyncClipboard" target="_blank" rel="noreferrer">Syncclipboard</a></td><td style="text-align:center;">跨平台剪贴板同步</td><td style="text-align:center;">-</td><td style="text-align:center;">5033</td></tr><tr><td style="text-align:center;"><a href="https://doc.sun-panel.top/zh_cn/" target="_blank" rel="noreferrer">Sun-Panel</a></td><td style="text-align:center;">NAS 导航页</td><td style="text-align:center;">-</td><td style="text-align:center;">3002</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/linuxserver/transmission" target="_blank" rel="noreferrer">Transmission</a></td><td style="text-align:center;">BT、PT 下载客户端</td><td style="text-align:center;">downloads</td><td style="text-align:center;">9091</td></tr><tr><td style="text-align:center;"><a href="https://github.com/louislam/uptime-kuma" target="_blank" rel="noreferrer">UptimeKuma</a></td><td style="text-align:center;">服务监控</td><td style="text-align:center;">-</td><td style="text-align:center;">3001</td></tr><tr><td style="text-align:center;"><a href="https://hub.docker.com/r/vaultwarden/server" target="_blank" rel="noreferrer">Vaultwarden</a></td><td style="text-align:center;">开源好用的密码管理器</td><td style="text-align:center;">-</td><td style="text-align:center;">8030</td></tr><tr><td style="text-align:center;"><a href="https://github.com/cooderl/wewe-rss" target="_blank" rel="noreferrer">WeWeRSS</a></td><td style="text-align:center;">通过 RSS 订阅微信公众号</td><td style="text-align:center;">-</td><td style="text-align:center;">4000</td></tr><tr><td style="text-align:center;"><a href="https://help.onethingcloud.com/7cb4/2c7f" target="_blank" rel="noreferrer">Wxedge</a></td><td style="text-align:center;">网心云</td><td style="text-align:center;">wxedge</td><td style="text-align:center;">18888</td></tr><tr><td style="text-align:center;"><a href="https://github.com/ellite/Wallos" target="_blank" rel="noreferrer">Wallos</a></td><td style="text-align:center;">个人订阅管理</td><td style="text-align:center;">-</td><td style="text-align:center;">8282</td></tr><tr><td style="text-align:center;"><a href="https://github.com/monlor/docker-xiaoya" target="_blank" rel="noreferrer">Xiaoya</a></td><td style="text-align:center;">小雅全家桶</td><td style="text-align:center;">-</td><td style="text-align:center;">5678</td></tr><tr><td style="text-align:center;"><a href="https://github.com/cnk3x/xunlei" target="_blank" rel="noreferrer">Xunlei</a></td><td style="text-align:center;">迅雷</td><td style="text-align:center;">downloads</td><td style="text-align:center;">2345</td></tr></tbody></table><ul><li>qBittorrent 内置了两套 WebUI，分别为 <code>vuetorrent</code> 和 <code>qb-web</code>。可以在 <code>设置</code> -&gt; <code>Web UI</code> 中切换。需要勾选 <code>使用备用 Web UI</code>，文件路径设置为：<code>/config/vuetorrent</code> 或 <code>/config/qb-web</code>。</li></ul><h3 id="默认密码" tabindex="-1">默认密码 <a class="header-anchor" href="#默认密码" aria-label="Permalink to &quot;默认密码&quot;">​</a></h3><p>访问方式：<code>NAS IP:默认 Web 端口</code>。</p><ul><li>AList、qBittorrent 默认密码可以到容器日志中查看。</li><li>Aria2-Pro 默认 <code>RPC_SECRET</code>：P3TERX</li><li>Calibre-Web 默认用户名/密码：admin/admin123。</li><li>FileBrowser 默认用户名/密码：admin/admin。</li><li>迅雷内测码：<code>我不是矿神IMNKS</code></li><li>Miniflux 默认用户名/密码：admin/test123</li><li>Planka 默认用户名/密码：admin/admin</li><li>Syncclipboard 默认用户名/密码：admin/admin</li><li>Sun-Panel 默认用户名/密码：admin@sun.cc/12345678</li><li>xiaoya 全家桶默认用户信息请查看<a href="https://github.com/monlor/docker-xiaoya" target="_blank" rel="noreferrer">项目介绍</a>。</li><li>WeWeRSS 默认授权码：123456</li></ul><h2 id="如何使用" tabindex="-1">如何使用？ <a class="header-anchor" href="#如何使用" aria-label="Permalink to &quot;如何使用？&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">提示</p><p>建议 fnOS 中至少有一块 SSD 用来存储 docker 镜像和配置。第一次打开 docker 应用时，fnOS 会提示存储位置，可以将默认存储位置设置到这个 SSD 上，之后 docker 镜像就会保存到这块 SSD 里。</p><p>在系统自带的文件管理器中，切换到 <code>管理员视角</code>，在 SSD 的存储空间中就可以看到有个 <code>docker</code> 文件夹， 该文件夹就保存了 <code>docker</code> 镜像，运行环境，网络，插件等等。</p><p>需要注意的是，这个 <code>docker</code> 文件夹的位置位于存储空间根目录，和下面说的 <code>docker</code> 配置文件夹是两回事。比如选择了 docker 存储空间为 <code>/vol1</code>，那么该 docker 的文件夹路径为 <code>/vol1/docker</code>。</p><p><img src="https://img.slarker.me/wiki/b7f53b07cf85475086fe98213b4aa363.png" alt=""></p></div><p>在 SSD 的存储空间中，新建一个 <code>docker</code> 配置文件夹，该文件夹的位置应该为 <code>/vol1/1000/docker</code>，<code>1000</code> 表示当前的用户 ID，将上面的 Compose 文件夹中的所有文件上传到 <code>docker</code> 配置目录，应该像下面这样：</p><p><img src="https://img.slarker.me/wiki/1e5e847f1af14f93b5bd17ca9aedbea6.png" alt=""></p><p>然后在 docker 应用中，逐个新建 <code>Compose</code> 项目，选择 <code>/vol1/1000/docker</code> 下面对应的 Compose 配置文件夹，确认所需映射的路径没问题，就可以一键安装 <code>Compose</code> 应用了。比如，以新建 <code>alist</code> Compose 项目为例：</p><p>在 <code>docker</code> -&gt; <code>Compose</code> 中新增项目，项目名称输入 <code>alist</code>，路径选择 <code>/vol1/1000/docker/alist</code>，会自动提示 <code>使用现有的 docker-compose 配置来创建项目</code>，勾选 <code>创建项目后立即启动</code>，点击 <code>完成</code> 就会自动拉取相关 docker 镜像并启动项目。</p><p><img src="https://img.slarker.me/wiki/910ff73f8ac54ddbbd60b7047dc7b56e.png" alt=""></p><h2 id="如何修改-compose-配置" tabindex="-1">如何修改 Compose 配置？ <a class="header-anchor" href="#如何修改-compose-配置" aria-label="Permalink to &quot;如何修改 Compose 配置？&quot;">​</a></h2><p>在 fnOS 中，后续如果需要修改 Compose 配置，并且让配置生效，请按下面的步骤来操作：</p><ul><li>停止 <code>Compose</code></li><li>修改 <code>yml</code> 配置</li><li>清除 <code>Compose</code></li><li>启动 <code>Compose</code></li></ul><h2 id="如何更新-compose-应用" tabindex="-1">如何更新 Compose 应用？ <a class="header-anchor" href="#如何更新-compose-应用" aria-label="Permalink to &quot;如何更新 Compose 应用？&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">提示</p><p>目前在 fnOS 的 docker GUI 暂不支持直接更新 Compose 应用，后面应该也会支持的。</p></div><h3 id="使用-watchtower-自动更新" tabindex="-1">使用 watchtower 自动更新 <a class="header-anchor" href="#使用-watchtower-自动更新" aria-label="Permalink to &quot;使用 watchtower 自动更新&quot;">​</a></h3><p>可以使用 <code>watchtower</code> 实现自动更新，上面分享的 Compose 模版默认不包含 <code>watchtower</code>。如果你想自动更新 Compose 应用，可以在 <code>docker-compose.yml</code> 中加入下面的配置（watchtower 部分），以 RSSHub 这个 Compose 为例：</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rsshub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rsshub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rsshub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1200:1200</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">diygod/rsshub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  watchtower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">containrrr/watchtower</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--interval 86400 --cleanup --remove-volumes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WATCHTOWER_CLEANUP=true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WATCHTOWER_REMOVE_VOLUMES=true</span></span></code></pre></div><p>其中的 <code>86400</code> 代表每 <code>24</code> 小时（3600*24）会自动检测更新，如果有新的镜像，会自动完成拉取镜像，删除容器，重建容器等一系列操作。</p><h3 id="使用命令手动更新" tabindex="-1">使用命令手动更新 <a class="header-anchor" href="#使用命令手动更新" aria-label="Permalink to &quot;使用命令手动更新&quot;">​</a></h3><p><a href="/fnos/ssh.html">使用 SSH 登录</a> fnOS，<code>cd</code> 进入到需要更新的应用的 Compose 配置目录（该目录下面有 <code>yml</code> 配置文件）。以 <code>immich</code> 为例：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 此处 docker 配置目录位于 vol1 存储池</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /vol1/1000/docker/immich</span></span></code></pre></div><p>依次按照下面的命令进行更新：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 先停止 compose 项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拉取最新镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 compose 项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><p><img src="https://img.slarker.me/wiki/1ad91aac7fa84ed491ad951deb1cd6e1.webp" alt=""></p>`,34)]))}const g=e(l,[["render",n]]);export{k as __pageData,g as default};
